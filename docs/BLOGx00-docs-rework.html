<!DOCTYPE html><html lang='en'><head><meta charset=utf-8>
<title>nfsu2-re/BLOGx00: Docs rework</title>
<style>
body {
	font-family: Tahoma,Arial,sans-serif;
	background: #888;
	color: #000;
}
header,
body > div {
	background: #fff;
	box-shadow: 0px 0px 4px #000;
	border: 1px solid #efefef;
	padding: 0 1em;
	margin: 1em auto;
	max-width: 60em;
}
h1 {
	margin: .3em;
}
header {
	background: #eee;
	text-align: center;
}
nav {
	line-height: 2em;
	margin: 1em 0;
}
nav a {
	padding: .2em .5em;
	background: #ddd;
	border-color: #555;
	border-style: ridge;
	border-width: 2px;
}
pre,
.sym > div:not(.mm) {
	margin: 1em 0;
	padding: .2em .5em;
	font-family: monospace;
	white-space: pre;
	overflow-x: auto;
}
pre {
	border: 2px solid #cdcdcd;
	background: #f7f7f7;
}
blockquote {
	background: #eee;
	border-left: 5px solid #aaa;
	padding: 1em;
	margin: 1em;
}
table {
        border-collapse: collapse;
}
td,th {
	padding: .1em .4em;
	border: 1px solid #000;
}
th {
        background: #f5f5f5;
}
details {
        padding: .2em .4em 0 .4em;
        margin: .5em 0;
        border: 1px solid #ccc;
        background: #eee;
}
summary {
        user-select: none;
        cursor: pointer;
}
.mm a[href^="funcs.html"],
.mm a[href^="vars.html"],
.mm a[href^="structs.html"],
.mm a[href^="enums.html"] {
	border-radius: 5px;
	padding: 0 .15em;
	font-family: monospace;
}
.mm a[href^="funcs.html"]:hover {
	background: #fdf;
}
.mm a[href^="vars.html"]:hover {
	background: #dfd;
}
.mm a[href^="structs.html"]:hover {
	background: #ddf;
}
.mm a[href^="enums.html"]:hover {
	background: #fdd;
}
nav a[href^="funcs.html"],
.mm a[href^="funcs.html"],
.func > div:not(.mm),
.struc > ul > li > pre {
	background: #fef;
	border-color: #f6f;
}
/*struc methods*/
.struc > ul > li > pre {
	white-space: pre-wrap;
	margin: -1px 0 0 0;
}
.struc > ul {
	margin: 0 0 1em 0;
	list-style: none;
	padding: 0;
}
.sym.struc > div {
	margin-bottom: 0;
}
.struc > div + a + div, .struc > ul + a + div {
	margin-top: 1em;
}
nav a[href^="structs.html"],
.mm a[href^="structs.html"],
.struc > div:not(.mm) {
	background: #eef;
	border-color: #66f;
}
nav a[href^="enums.html"],
.mm a[href^="enums.html"],
.enum > div:not(.mm) {
	background: #fee;
	border-color: #f66;
}
nav a[href^="vars.html"],
.mm a[href^="vars.html"],
.var > div:not(.mm) {
	background: #efe;
	border-color: #5a5;
}
.sym > div:not(.mm),
/*struc methods*/
.struc > ul > li > pre {
	border-width: 1px;
	border-style: solid;
}
div h3 {
	display: inline;
	font-size: 1em;
	font-weight: bold;
}
body > div > ul i,
body > div > div i {
	font-style: normal;
	font-size: 80%;
	color: #777;
}
/*class label*/
.struc h2 + ul em::after,
.struc h3 + i + em::after {
	content: "/*class*/";
	font-style: normal;
	background: #d4aaff;
	border: 1px solid #94f;
	font-size: 80%;
	border-radius: 3px;
}
.struc h2 + ul em::after {
	content: "class";
	padding: 0 .2em;
}
/*union emphasis/label*/
.struc h2 + ul b::after,
body > div > div b {
	font-weight: normal;
	background: #aadfff;
	border: 1px solid #44b9ff;
	font-size: 90%;
	border-radius: 3px;
}
.struc h2 + ul b::after {
	content: "union";
	padding: 0 .2em;
	font-size: 80%;
}
.struc h2 + ul b {
	font-weight: normal;
}
/*unknown type*/
body > div > div u {
	text-decoration: none;
}
span.uctype,
body > div > div u::after {
	content: "/*unconfirmed type*/";
	background: #fca;
	border: 1px solid #f94;
	font-size: 80%;
	border-radius: 6px;
	color: #000;
}
/*reference to unknown struct/enum*/
.mm .error,
body > div.sym > div strong {
	background: #f00;
	color: #fff;
}
/*doccomment*/
body > div > div > span {
	color: #080;
	display: inline-block;
	margin-left: 5em; /*why 5 and not 8?*/
	/*so doccomments on their own don't cause scrollbars*/
	white-space: pre-wrap;
}
a.ext::after {
	display: inline-block;
	content: '';
	width: 12px;
	height: 12px;
	background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAM\
AgMAAAArG7R0AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAJcEhZcwAADsMAAA7DAcdvqGQ\
AAAAJUExURUdwTAD/AAAA//ENIZIAAAABdFJOUwBA5thmAAAAL0lEQVQI12NggAFRBwaG0AQGptAVDF\
wzsxi4Zq1k4JqaCcZMU1cwMCxbwMCg1QAArE8JoyhJwYoAAAAASUVORK5CYII=') no-repeat;
}
/*symbol comments*/
.sym div.mm {
	background: #efefef;
	border: 1px dashed #000;
	border-bottom: 0;
	margin-bottom: 0;
	padding: .2em .5em;
}
.sym div.mm + div {
	margin-top: 0;
}
/*mm stuff mostly used in docs*/
div.mm div {
	margin: 2em 0;
	padding-left: 1em;
	border-left: 3px ridge #666;
}
div.mm p.center {
	text-align: center;
}
div.mm p.imgholder {
	text-align: center;
	margin: 3em 0;
}
code {
	background: #dfdfdf;
	padding: 0 .2em;
	border-radius: 3px;
}
div.mm h2 a, div.mm h3 a, div.mm h4 a, div.mm h5 a, div.mm h6 a {
	color: #A0A0A0;
}
pre.ida {
	color: #000080;
	font-weight: bold;
}
pre.ida span.text,
pre.ida span.mt {
	color: #000;
}
pre.ida span.comment,
pre.ida span.mc {
	color: #808080;
}
pre.ida span.ident {
	color: #0000ff;
}
pre.ida span.num, pre.ida span.str {
	color: #008000;
}
pre.ida span.hi {
	background: #ff0;
}
</style></head><body>
<header>
<h1>nfsu2-re</h1>
<p><a href='https://github.com/yugecin/nfsu2-re'>https://github.com/yugecin/nfsu2-re</a></p>
<nav><a href='index.html'>home</a>
<a href='blog.html'>blog</a>
<a href='docs.html'>docs</a>
<a href='funcs.html' class='func'>functions</a>
<a href='structs.html' class='struc'>structs</a>
<a href='enums.html' class='enum'>enums</a>
<a href='vars.html' class='var'>variables</a>
<a href='cheatsheet.html'>cheatsheet</a></nav>
</header>
<div class='mm'>
<p><a href='blog.html'>blog</a> &gt; Docs rework (2022 Apr 23)</p><div><h2 id="docsrework">Docs rework <a href='#docsrework'>#</a></h2>
<p>Alright, finally after 2.5 months of on-off work, the rework/revamp of this
documentation website is done. Previously this website was just a single (huge)
page with a lot of text and symbol information in between, now that same
information is split between the <a href="docs.html">docs</a> and
<a href="funcs.html">functions</a>/<a href="structs.html">structs</a>/<a href="enums.html">enums</a>/<a href="vars.html">variables</a> pages.
There's also this new 'blog' section, so I can put more 'discovering' style
content in here and keep the docs more clean and tidy and to-the-point.
<p><a class="ext" href="https://github.com/yugecin/nfsu2-re/commit/7c18467184fe0d8a8ad13b6c320272320c80b897">In the beginning I wrote the docs html manually</a>, which was fine for a while
but soon became a tedious job. I'm not a big fan of Markdown because it seems
like many places use a different dialect (the meaning for <code>__</code>/<code>**</code>/<code>*</code> may
differ, for example on Slack and Discord) and certain elements (like links)
break the flow of the text in source form. So at some point I came up with an
idea for a markup language and <a class="ext" href="https://github.com/yugecin/nfsu2-re/commit/3f93d854d0c045e0c937f41c628ebf6e20bdf7db">I made a first implementation of mmparse.c</a>.
I named this 'margin markup' because the configuration of the presentation
would be put in the document's margin. It has its own problems of course (for
example you constantly need to reorder/copy the margin when editing lines) but
so far I think the positives outweigh the negatives.
<p>That was better, but I still copied symbol information from my IDA database
into the docs manually. That means it could get outdated very easily,
information would be spread between the docs and the IDA database (because
usually I put function descriptions in the docs but not as comments in IDA)
and it is just an annoying chore to synchronize it all the time.
<p>Then at some point I had the idea of just generating these docs based on the
IDA database. Since the IDA database is a binary file, which is undocumented
(I think), and may change between versions of IDA, I decided to use the
'dump database to IDC file' feature of IDA and parse that IDC file instead.
IDC is some kind of custom c-like scripting language, so I wrote a parser
for that (<code><a class='ext' href='https://github.com/yugecin/nfsu2-re/blob/master/docs/idcparse.c'>docs/idcparse.c</a></code>).
<p>After doing that, I moved all of the function/structure documentation into
comments in IDA, which now also get parsed using the 'margin markup' format
I made. Now I can write docs and blogposts and easily link to all of the
symbols, because they are written to their html pages and anchors are added
as needed.
<div><p>Small example:
<pre>
Here's a function {529B50} and variable {838454} struct {struct SmsData} and  ||| ref,ref,ref
enum {enum SMS_TYPE} with members {{struct SmsData+2} == {enum SMS_TYPE/0x4}} ||| ref,code,ref,ref
struct inner member and chained members {{struct Career.5D20.1404}}           ||| code,ref
with pointer {{struct SmsMessage.0.2}}                                        ||| code,ref
chained from variable of type struct {{838640.328}}                           ||| code,ref
chained from variable of type struct pointer {{8384C4.8.E4}}                  ||| code,ref
</pre>
<p>Results in:
<p>Here's a function <a href=funcs.html#529B50>SmsMessageList::SendOutrunInfoSms</a> and variable <a href=vars.html#838454>smsDatas</a> struct <a href=structs.html#struc_SmsData>struct SmsData</a> and
enum <a href=enums.html#enu_SMS_TYPE>enum SMS_TYPE</a> with members <code><a href=structs.html#struc_SmsData@2>type</a> == <a href=enums.html#enu_SMS_TYPE4>SMS_TYPE_OUTRUN_INFO</a></code>
struct inner member and chained members <code><a href=structs.html#struc_Career>struct Career</a>.<a href=structs.html#struc_Career@5D20>smsMessageList</a>.<a href=structs.html#struc_SmsMessageList@1404>numUnreadMessages</a></code>
with pointer <code><a href=structs.html#struc_SmsMessage>struct SmsMessage</a>.<a href=structs.html#struc_SmsMessage@0>data</a>-><a href=structs.html#struc_SmsData@2>type</a></code>
chained from variable of type struct <code><a href=vars.html#838640>shownDialog</a>.<a href=structs.html#struc_DialogInfo@328>numButtons</a></code>
chained from variable of type struct pointer <code><a href=vars.html#8384C4>pUIData</a>-><a href=structs.html#struc_UIData@8>field_8</a>-><a href=structs.html#struc_UIData_field8@DC>fngPackagesDC</a>.<a href=structs.html#struc_FNGInfoList@0>__parent</a>.<a href=structs.html#struc_List@8>first</a></code>
<p style='text-align:right'><small><a href='#index'>Index</a></small></p>
</div>
<p><small><a href='#docsrework'>Docs rework</a> (continuation)</small></p>
<p>When a struct or enum changes name now, I'll get an error while the docs are
being generated. That way the docs can't be too desynchronized anymore from
what I have in the IDA database. Function and variable name changes are free
because those are referenced by their addresses, so nothing in the docs source
needs to be updated for those.
<p>Now I probably won't touch this project for a few months while I go back to
another project that I haven't touched in months :^)
<p style='text-align:right'><small><a href='#index'>Index</a></small></p>
</div>

</div></body></html>
